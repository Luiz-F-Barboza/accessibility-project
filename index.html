<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Guia por Voz - IFBA Jacobina</title>
  <style>
    /* Reset b√°sico */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }

    body {
      background: #f4f6f9;
      color: #222;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: background 0.3s, color 0.3s;
    }

    /* Modo escuro */
    .dark-mode {
      background: #121212;
      color: #ffffff;
    }

    header {
      text-align: center;
      padding: 2rem 1rem;
      background: #006241;
      /* Verde IFBA */
      color: #fff;
      border-bottom: 4px solid #00492f;
    }

    header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    header p {
      font-size: 1rem;
      opacity: 0.9;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    button {
      background: #006241;
      color: #fff;
      border: none;
      padding: 1rem 2rem;
      font-size: 1.1rem;
      font-weight: 500;
      border-radius: 12px;
      cursor: pointer;
      transition: 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    button:hover {
      background: #008f5f;
      transform: translateY(-3px);
    }

    .output {
      background: #fff;
      color: #333;
      padding: 1.5rem 2rem;
      border-radius: 12px;
      font-size: 1.2rem;
      text-align: center;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border-left: 6px solid #006241;
    }

    .dark-mode .output {
      background: #1e1e1e;
      color: #fff;
      border-left: 6px solid #00ff9f;
    }

    footer {
      text-align: center;
      padding: 1rem;
      font-size: 0.9rem;
      background: #f0f0f0;
      border-top: 1px solid #ddd;
      color: #444;
    }

    .dark-mode footer {
      background: #1e1e1e;
      color: #ccc;
      border-top: 1px solid #333;
    }
  </style>
</head>

<body>
  <header>
    <h1>Guia por Voz - IFBA Jacobina</h1>
    <p>Fale o nome de um local para ver a rota e dist√¢ncia.</p>
  </header>

  <main>
    <div class="controls">
      <button id="btn-start">üé§ Iniciar</button>
      <button id="btn-stop">‚úã Parar</button>
    </div>
    <div class="output">Fale um local do IFBA Jacobina...</div>
  </main>

  <footer>
    <p>Projeto de acessibilidade - Navega√ß√£o por voz no campus</p>
  </footer>

  <script>
    // Reconhecimento de voz
    var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
    var recognition = new SpeechRecognition();

    recognition.continuous = true;
    recognition.lang = 'pt-BR';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    var diagnostic = document.querySelector('.output');

    // Pontos do campus (n√≥s) - coordenadas reais
    const pontos = {
      entrada: { lat: -11.1820000, lng: -40.536900 }, // Entrada principal (adicione a coordenada real se necess√°rio)
      bifurcacao1: { lat: -11.1823076, lng: -40.536858 }, // Primeira bifurca√ß√£o
      bifurcacao2: { lat: -11.1822864, lng: -40.5366955 }, // Segunda bifurca√ß√£o
      direcao_ensino: { lat: -11.182414, lng: -40.5367314 },
      direcao: { lat: -11.1829314, lng: -40.5370565 }, // Dire√ß√£o Geral
      gabinete: { lat: -11.1829577, lng: -40.5371 },
      gabinete_comunicacao: { lat: -11.1825766, lng: -40.5368283 }, // Gabinete de comunica√ß√£o e audiovisual
      setor_pedagogico: { lat: -11.1827908, lng: -40.5370218 },
      capne: { lat: -11.1828657, lng: -40.5370838 },
      cores: { lat: -11.182339, lng: -40.5367162 }
    };

    // Grafo (arestas) - conex√µes baseadas no mapa
    const grafo = {
      entrada: ["bifurcacao1"],
      bifurcacao1: ["entrada", "bifurcacao2", "gabinete_comunicacao"],
      gabinete_comunicacao: ["bifurcacao1"],
      bifurcacao2: ["bifurcacao1", "direcao_ensino", "direcao", "gabinete", "setor_pedagogico", "capne", "cores"],
      direcao_ensino: ["bifurcacao2"],
      direcao: ["bifurcacao2", "gabinete"],
      gabinete: ["direcao", "bifurcacao2"],
      setor_pedagogico: ["bifurcacao2"],
      capne: ["bifurcacao2"],
      cores: ["bifurcacao2"]
    };

    // Calcula dist√¢ncia Haversine
    function calcularDistancia(lat1, lon1, lat2, lon2) {
      const R = 6371e3;
      const toRad = angle => angle * Math.PI / 180;
      const œÜ1 = toRad(lat1);
      const œÜ2 = toRad(lat2);
      const ŒîœÜ = toRad(lat2 - lat1);
      const ŒîŒª = toRad(lon2 - lon1);
      const a = Math.sin(ŒîœÜ / 2) ** 2 + Math.cos(œÜ1) * Math.cos(œÜ2) * Math.sin(ŒîŒª / 2) ** 2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    // Dijkstra simplificado
    function dijkstra(grafo, inicio, fim) {
      let dist = {}, prev = {}, visitados = new Set();
      for (let no in grafo) { dist[no] = Infinity; prev[no] = null; }
      dist[inicio] = 0;

      while (visitados.size < Object.keys(grafo).length) {
        let u = null;
        for (let no in dist) {
          if (!visitados.has(no) && (u === null || dist[no] < dist[u])) u = no;
        }
        if (u === null || dist[u] === Infinity) break;
        visitados.add(u);
        for (let vizinho of grafo[u]) {
          let d = calcularDistancia(pontos[u].lat, pontos[u].lng, pontos[vizinho].lat, pontos[vizinho].lng);
          let alt = dist[u] + d;
          if (alt < dist[vizinho]) { dist[vizinho] = alt; prev[vizinho] = u; }
        }
      }

      let caminho = []; let atual = fim;
      while (atual) { caminho.unshift(atual); atual = prev[atual]; }
      return { caminho, distancia: dist[fim] };
    }

    // Fun√ß√£o para narrar o caminho
    function narrarCaminho(texto) {
      if ('speechSynthesis' in window) {
        const utter = new SpeechSynthesisUtterance(texto);
        utter.lang = 'pt-BR';
        window.speechSynthesis.speak(utter);
      }
    }

    // Fun√ß√£o para ir at√© o local
    function irPara(local) {
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(function (position) {
          // Ponto de in√≠cio fixo: entrada
          let inicio = "entrada";
          let fim = local;

          if (pontos[fim]) {
            let resultado = dijkstra(grafo, inicio, fim);
            let distancia = resultado.distancia;
            let textoDistancia = distancia >= 1000 ? (distancia / 1000).toFixed(2) + " quil√¥metros" : Math.round(distancia) + " metros";
            let destinoFalado = fim.replace(/_/g, ' ')
              .replace('direcao', 'dire√ß√£o geral')
              .replace('direcao ensino', 'dire√ß√£o de ensino')
              .replace('gabinete comunicacao', 'gabinete de comunica√ß√£o e audiovisual')
              .replace('setor pedagogico', 'setor pedag√≥gico')
              .replace('capne', 'CAPNE')
              .replace('cores', 'corredor das cores')
              .replace('bifurcacao1', 'primeira bifurca√ß√£o')
              .replace('bifurcacao2', 'segunda bifurca√ß√£o');
            let textoRota = `Rota at√© ${destinoFalado} (${textoDistancia}). Caminho: ${resultado.caminho.map(p => p.replace(/_/g, ' ').replace('direcao', 'dire√ß√£o geral').replace('direcao ensino', 'dire√ß√£o de ensino').replace('gabinete comunicacao', 'gabinete de comunica√ß√£o e audiovisual').replace('setor pedagogico', 'setor pedag√≥gico').replace('capne', 'CAPNE').replace('cores', 'corredor das cores').replace('bifurcacao1', 'primeira bifurca√ß√£o').replace('bifurcacao2', 'segunda bifurca√ß√£o')).join(', ')}.`;
            diagnostic.textContent = textoRota;
            narrarCaminho(textoRota);
          } else {
            diagnostic.textContent = "Local n√£o encontrado no mapa.";
            narrarCaminho("Local n√£o encontrado no mapa.");
          }
        }, function (error) {
          diagnostic.textContent = "Erro ao acessar sua localiza√ß√£o.";
          narrarCaminho("Erro ao acessar sua localiza√ß√£o.");
        });
      } else {
        diagnostic.textContent = "Seu navegador n√£o suporta geolocaliza√ß√£o.";
        narrarCaminho("Seu navegador n√£o suporta geolocaliza√ß√£o.");
      }
    }

    // Reconhecimento de voz
    recognition.onresult = function (event) {
      let length = event.results.length;
      let command = event.results[length - 1][0].transcript.trim().toLowerCase();

      switch (true) {
        case command.includes("modo escuro"):
          document.body.classList.add("dark-mode");
          diagnostic.textContent = "Modo escuro ativado!";
          narrarCaminho("Modo escuro ativado!");
          break;
        case command.includes("modo claro"):
          document.body.classList.remove("dark-mode");
          diagnostic.textContent = "Modo claro ativado!";
          narrarCaminho("Modo claro ativado!");
          break;
        case command.includes("dire√ß√£o geral"):
          irPara("direcao");
          break;
        case command.includes("dire√ß√£o de ensino"):
          irPara("direcao_ensino");
          break;
        case command.includes("gabinete"):
          irPara("gabinete");
          break;
        case command.includes("gabinete de comunica√ß√£o"):
        case command.includes("comunica√ß√£o"):
          irPara("gabinete_comunicacao");
          break;
        case command.includes("setor pedag√≥gico"):
          irPara("setor_pedagogico");
          break;
        case command.includes("capne"):
          irPara("capne");
          break;
        case command.includes("cores"):
          irPara("cores");
          break;
        case command.includes("primeira bifurca√ß√£o"):
          irPara("bifurcacao1");
          break;
        case command.includes("segunda bifurca√ß√£o"):
          irPara("bifurcacao2");
          break;
        default:
          diagnostic.textContent = "Local n√£o reconhecido. Tente novamente.";
          narrarCaminho("Local n√£o reconhecido. Tente novamente.");
      }
    }

    // Bot√µes de controle
    document.querySelector('#btn-start').onclick = function () {
      recognition.start();
      diagnostic.textContent = "Estou ouvindo... diga um local!";
    }
    document.querySelector('#btn-stop').onclick = function () {
      recognition.stop();
      diagnostic.textContent = "Reconhecimento de voz parado.";
    }
  </script>
</body>

</html>